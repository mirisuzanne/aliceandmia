{% extends "layout.html" %}

{% import 'utility.macros.j2' as utility %}
{% import 'layout.macros.j2' as layout %}
{% import 'blog/macros.j2' as blog %}


{%- block title -%}
  {{ [rst.title, super()]|join(' | ') }}
{%- endblock -%}


{%- block description -%}
  {{ ctx.render_summary()|striptags or super() }}
{%- endblock -%}


{%- block og_title -%}
  {{ rst.title }}
{%- endblock -%}


{%- block og_url -%}
  {{ get_full_canonical_url(ctx.builder, slug=ctx.slug) }}
{%- endblock -%}


{%- block og_description -%}
  {{ ctx.render_summary()|striptags or super() }}
{%- endblock -%}


{%- block og_type -%}
  {%- set type = ctx.pub_date if ctx.config.mp3 else super() -%}
  {%- set type = 'video.movie' if ctx.config.mp3 else type -%}
  {{- type -}}
{%- endblock -%}


{%- block twitter_type -%}
  {% set has_image = (ctx.config.image and ctx.config.image[0].src) %}
  {{ 'summary_large_image' if has_image else super() }}
{%- endblock -%}


{% block extra_og %}
  {% if ctx.pub_date %}
    <meta property="article:published_time" content="{{ ctx.pub_date.isoformat() }}" />
  {% endif %}
  {% if ctx.tags %}
    {% for tag in ctx.tags %}
      <meta property="article:tag" content="{{ tag }}" />
    {% endfor %}
  {% endif %}
  {% if ctx.config.mp3 %}
    <meta property="og:audio:type" content="audio/mp3" />
    <meta property="og:audio" content="http://{{ ctx.config.mp3 }}" />
    <meta property="og:audio:secure_url" content="https://{{ ctx.config.mp3 }}" />
    <meta property="og:video" content="http://{{ ctx.config.mp3 }}" />
    <meta property="og:video:secure_url" content="https://{{ ctx.config.mp3 }}" />
    <meta property="og:video:type" content="video/mp4" />
    <meta property="og:video:width" content="480" />
    <meta property="og:video:height" content="50" />
  {% endif %}
{% endblock %}


{% block site_title %}
  {% set has_title =  none if ctx.config.hide_title else rst.title %}
  {{ layout.title(config, has_title) }}
{% endblock %}


{% block body %}
  {{ blog.detail(
    title=rst.title if not ctx.config.hide_title,
    intro=ctx.render_summary(),
    image=ctx.config.image[0] if ctx.config.image else none,
    body=rst.fragment,
    action=ctx.config.elsewhere,
    pub_date=ctx.pub_date,
    post_tags=ctx.tags,
    tag_pages=config.tag_pages
  ) }}
{% endblock %}
